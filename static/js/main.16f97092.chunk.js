(this.webpackJsonpmychat=this.webpackJsonpmychat||[]).push([[0],{124:function(e,t,a){},125:function(e,t,a){},166:function(e,t,a){e.exports=a.p+"static/media/boyDog.2ded17b8.svg"},177:function(e,t,a){e.exports=a.p+"static/media/alien.80bf226b.svg"},195:function(e,t,a){e.exports=a(375)},200:function(e,t,a){},201:function(e,t,a){},206:function(e,t,a){},207:function(e,t,a){},285:function(e,t){},288:function(e,t,a){},289:function(e,t,a){},290:function(e,t,a){},375:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(10),l=a.n(c),s=(a(200),a(34)),o=a(35),i=a(84),u=a(37),m=a(36),p=(a(201),a(124),function(e){return e.warn?r.a.createElement("div",{className:"block-helper"},"-------------------------------------"):null}),d=a(23),f=a(11),h=(a(125),a(166)),g=a.n(h),E=(a(206),a(191)),v=(a(207),a(380)),b=(a(126),a(122)),y=a(381),O=a(382),w=a(7),k=a.n(w),j=a(27),S=a(18),N=a(19),x=a(193);var C=function(e,t){return function(){var a=Object(j.a)(k.a.mark((function a(n){var r;return k.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n({status:"PENDING",payload:null,error:null,type:"PROMISE",key:e}),a.prev=1,a.next=4,t;case 4:return r=a.sent,n({status:"RESOLVED",payload:r,error:null,type:"PROMISE",key:e}),a.abrupt("return",r);case 9:a.prev=9,a.t0=a.catch(1),n({status:"REJECTED",payload:null,error:a.t0,type:"PROMISE",key:e});case 12:case"end":return a.stop()}}),a,null,[[1,9]])})));return function(e){return a.apply(this,arguments)}}()},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(j.a)(k.a.mark((function a(){var n,r,c,l=arguments;return k.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=l.length>0&&void 0!==l[0]?l[0]:"",r=l.length>1&&void 0!==l[1]?l[1]:{},a.next=4,fetch(e,{method:"POST",headers:Object(N.a)({Accept:"application/json","Content-Type":"application/json"},t),body:JSON.stringify({query:n,variables:r})}).then((function(e){return e.json()}));case 4:if(!(c=a.sent).errors){a.next=7;break}throw new Error(c.errors);case 7:return a.abrupt("return",c);case 8:case"end":return a.stop()}}),a)})))}("http://chat.fs.a-level.com.ua/graphql",{Authorization:"Bearer "+localStorage.authToken}),T=a(167),q=a(38),P=a(168);var A=a(169);var I=a(192),R=Object(I.a)(),F=Object(q.c)({auth:function(e,t){if(!e){if(!localStorage.authToken)return{};t.type="AUTH_LOGIN",t.token=localStorage.authToken}if("AUTH_LOGIN"===t.type){var a=t.token,n=P(a);return localStorage.setItem("authToken",a),{jwt:a,data:n}}return"AUTH_LOGOUT"===t.type?(localStorage.setItem("authToken",""),{}):e},promise:function(e,t){var a=t.type,n=t.key,r=Object(x.a)(t,["type","key"]);return e?"PROMISE"===a?Object(N.a)({},e,Object(S.a)({},n,r)):e:{}},chats:function(e,t){var a=t.type,n=t.payload,r=t.message;if(!e)return{};if("SAVE_CHATS"===a){var c,l=Object(A.a)(n);try{for(l.s();!(c=l.n()).done;){var s=c.value,o=s.messages.reduce((function(e,t){return e[t._id]=t,e}),{});s.messages=o}}catch(m){l.e(m)}finally{l.f()}var i=n.reduce((function(e,t){return e[t._id]=t,e}),{});return Object(N.a)({},e,{},i)}if("SAVE_MESSAGE"===a){if(e[r.chat._id]){var u=e[r.chat._id].messages;e[r.chat._id].messages=Object(N.a)({},u,Object(S.a)({},r._id,r))}return Object(N.a)({},e)}return e},search:function(e,t){var a=t.type,n=t.query,r=t.result;return e?"SEARCH"===a?Object(N.a)({},e,{query:n}):"SEARCH_RESULT"===a?Object(N.a)({},e,{result:r}):e:{query:"",result:null}}}),M=Object(q.e)(F,Object(q.a)(T.a,R));M.subscribe((function(){return console.log(M.getState())}));var L=function(e){return{type:"AUTH_LOGIN",token:e}},$=function(e,t){return{status:"RESOLVED",payload:t,error:null,type:"PROMISE",key:e}},U=function(e,t){return{status:"REJECTED",payload:null,error:t,type:"PROMISE",key:e}},H=function(e){return{type:"SAVE_CHATS",payload:e}};function G(e){return function(){var t=Object(j.a)(k.a.mark((function t(a){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(C("newmessage",_('mutation MesRedAll($text: String){\n              MessageUpsert (message: {\n              text: $text\n              chat: {\n              _id:"5ec6589b346e9e2323178740"\n              }\n              }){\n              _id\n              text\n              owner {\n              login\n              }\n              }\n              }',{text:e})));case 2:t.sent;case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}M.dispatch(function(e){var t=[{_id:e}];return function(){var e=Object(j.a)(k.a.mark((function e(a){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(C("allmessages",_(" query CFO($q: String){\n            ChatFindOne(query: $q){\n              _id\n             \n              messages {\n                text\n                owner {\n                  login\n                }\n              }\n            }\n          }\n          ",{q:JSON.stringify(t)})));case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}()),M.dispatch(G());var V=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={isOpen:!1,loadings:[]},e.enterLoading=function(t){var a=Object(E.a)(e.state.loadings);a[t]=!0,e.setState({loadings:a}),setTimeout((function(){a[t]=!1,e.setState({loadings:a})}),6e3)},e}return Object(o.a)(a,[{key:"render",value:function(){var e=this,t=this.state.loadings;return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{onClick:function(){return e.setState({isOpen:!0})},type:"primary",icon:r.a.createElement(v.a,null)}),this.state.isOpen&&r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"modal-body"},r.a.createElement("div",{className:"close"}," ",r.a.createElement(b.a,{type:"primary",icon:r.a.createElement(y.a,null),loading:t[2],onClick:function(){return e.setState({isOpen:!1})}})),r.a.createElement("div",{className:"modal-user-info"}),r.a.createElement("div",{className:"modal-navigation"}),r.a.createElement("div",{className:"modal-about"}),r.a.createElement(D,{className:"ant-btn ant-btn-primary"},r.a.createElement(d.a,{to:"/"},r.a.createElement(O.a,null)," Log out")))))}}]),a}(r.a.Component),D=Object(f.b)((function(e){return{disabled:!e.auth.data}}),{onClick:function(){return{type:"AUTH_LOGOUT"}}})(b.a),J=a(42),W=k.a.mark(X),z=k.a.mark(Z),B=k.a.mark(ee),Y=k.a.mark(te),K=k.a.mark(ae),Q=function(e){return new Promise((function(t){return setTimeout((function(){return t(e)}),e)}))};function X(e){var t,a,n;return k.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.query,console.log("search query started to server",t),r.t0=console,r.next=5,Q(2e3);case 5:return r.t1=r.sent,r.t0.log.call(r.t0,r.t1),a="/".concat(t,"/"),r.next=10,_("query User($query: String){\n          UserFind(query: $query){\n            _id\n            login\n            nick\n          }\n        }",{query:JSON.stringify([{$or:[{login:a},{nick:a}]}])});case 10:return n=r.sent,r.next=13,Object(J.b)({type:"SEARCH_RESULT",result:n.data.UserFind});case 13:console.log("search query finish",t);case 14:case"end":return r.stop()}}),W)}function Z(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(J.d)("SEARCH",X);case 2:case"end":return e.stop()}}),z)}function ee(e){var t,a,n;return k.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.key,a=e.promise,"PENDING"!==e.status){r.next=16;break}return r.prev=2,r.next=5,a;case 5:return n=r.sent,r.next=8,Object(J.b)($(t,n));case 8:return r.next=10,Object(J.b)(H(n.data.ChatFind));case 10:r.next=16;break;case 12:return r.prev=12,r.t0=r.catch(2),r.next=16,Object(J.b)(U(t,r.t0));case 16:case"end":return r.stop()}}),B,null,[[2,12]])}function te(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("watcher"),e.next=3,Object(J.c)("PROMISE",ee);case 3:case"end":return e.stop()}}),Y)}function ae(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(J.a)([Z(),te()]);case 2:case"end":return e.stop()}}),K)}var ne=Object(f.b)((function(e){return{value:e.search.query,placeholder:"Search..."}}),{onChange:function(e){return{type:"SEARCH",query:e.target.value}}})("input"),re=[{_id:"5e25df7f1719bf13be585723",login:"test2",nick:""},{_id:"5e25e0a41719bf13be585729",login:"test3",nick:""}],ce=Object(f.b)((function(e){return{users:e.search.result||[]}}))((function(e){var t=e.users,a=void 0===t?re:t;return r.a.createElement("div",{style:{border:"2px solid black"}},a.map((function(e){return r.a.createElement("div",{key:e._id},r.a.createElement(d.a,{to:"/user/".concat(e._id)},e.login," (",e.nick,")"))})))}));R.run(ae),M.dispatch(function(){var e,t,a=JSON.stringify([{___owner:"5e97105693e2915e617c6fc1"},{sort:[{_id:-1}]}]);return e="chats",t=_("query ChatF($owner: String){\n            ChatFind(query: $owner) {\n              _id\n              owner {\n                login\n              }\n              title\n              members {\n                login\n              }\n              messages {\n                _id\n                text\n                chat {\n                  title\n                }\n                owner {\n                  login\n                }\n              }\n            }\n          }",{owner:a}),{status:"PENDING",payload:null,error:null,type:"PROMISE",key:e,promise:t}}());var le=a(383),se=function(){return r.a.createElement("div",{className:"block-user-header"},r.a.createElement(V,null),r.a.createElement("div",null,r.a.createElement("span",{class:"fa fa-address-book-o","aria-hidden":"true"},r.a.createElement(le.a,null)),r.a.createElement(ne,{className:"input-search"})))},oe=function(){return r.a.createElement("div",{className:"block-chat-header"},r.a.createElement("div",null,"Name chat"),r.a.createElement("div",null,"Menu"))},ie=function(){return r.a.createElement("img",{src:"https://flevix.com/wp-content/uploads/2019/07/Spin-Preloader.gif",alt:"loading"})},ue=function(){return r.a.createElement("div",{className:"main-page"},r.a.createElement("img",{src:g.a,alt:"page"}),r.a.createElement("h3",null,"Please select a chat to start messaging "))},me=a(176),pe=a.n(me),de=(a(288),pe()("http://chat.fs.a-level.com.ua/"));localStorage.authToken&&de.emit("jwt",localStorage.authToken),de.on("jwt_ok",(function(e){return console.log(e)})),de.on("jwt_fail",(function(e){return console.log(e)})),de.on("msg",(function(e){return M.dispatch(function(e){return console.log(e),{type:"SAVE_MESSAGE",message:e}}(e))}));var fe=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleSubmit=function(e){e.preventDefault();n.state.value},n.handleValueChange=function(e){n.setState({value:e.target.value})},n.state={value:""},n}return Object(o.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{className:"chat-message-form",onSubmit:this.handleSubmit},r.a.createElement("input",{type:"text",placeholder:"Type a message...",value:this.state.value,onChange:this.handleValueChange}),r.a.createElement("button",{onClick:function(){return e.props.onMessage(e.state.value)}},"Send")))}}]),a}(n.Component),he=function(e){var t=e.messages;return t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-message-list"},Object.values(t).map((function(e){return r.a.createElement(ge,{message:e,key:e._id})})))):r.a.createElement(ie,null)},ge=function(e){var t=e.message;return r.a.createElement("div",{className:"message",key:t._id},r.a.createElement("div",{className:"message-text"},t.text),r.a.createElement("div",{className:"message-username"},t.owner.login))},Ee=Object(f.b)((function(e){return{chats:e.chats}}))((function(e){var t=e.chats,a=e.match.params._id;return t[a]?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"block-chat-main"},r.a.createElement(he,{messages:t[a].messages}),r.a.createElement(ve,null))):r.a.createElement(ie,null)})),ve=Object(f.b)(null,{onMessage:G})(fe),be=Object(f.b)((function(e){return{chats:e.chats}}))((function(e){var t=e.chats;return t?r.a.createElement(r.a.Fragment,null,console.log(t),r.a.createElement("div",{className:"chats-list"},Object.values(t).map((function(e){return r.a.createElement("div",{className:"chat",key:e._id,chat:e},r.a.createElement(d.a,{to:"/chat/".concat(e._id)},e.title))})))):r.a.createElement(ie,null)})),ye=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={showWarning:!1},n.handleToggleClick=n.handleToggleClick.bind(Object(i.a)(n)),n}return Object(o.a)(a,[{key:"handleToggleClick",value:function(){this.setState((function(e){return{showWarning:!e.showWarning}}))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"header"},r.a.createElement(se,null),r.a.createElement(oe,null),r.a.createElement("button",{className:"ant-btn ant-btn-primary ant-btn-icon-only",onClick:this.handleToggleClick},this.state.showWarning?">":"<")),r.a.createElement(Oe,{warn:this.state.showWarning}))}}]),a}(n.Component),Oe=function(e){var t=e.warn;return r.a.createElement("main",{className:"main-block"},r.a.createElement("div",{className:"block-users-list"},r.a.createElement(ce,null),r.a.createElement(be,null)),r.a.createElement("div",{className:"block-chat"},r.a.createElement(ue,null)),r.a.createElement(p,{warn:t}))},we=a(40),ke=a(188),je=a.n(ke),Se=a(384),Ne=a(385),xe=(a(289),a(177)),Ce=a.n(xe),_e=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={login:"",password:""},e}return Object(o.a)(a,[{key:"render",value:function(){var e,t,a=this;return r.a.createElement("div",{className:"main-block"},r.a.createElement("div",{className:"block-login"},r.a.createElement("form",{className:"block-login-form"},r.a.createElement("img",{src:Ce.a,alt:"page"}),r.a.createElement("h1",null,"Sign in MyChat"),r.a.createElement("div",{className:"block-login-form-input"},r.a.createElement("div",null,r.a.createElement("span",{className:"form","aria-hidden":"true"},r.a.createElement(Se.a,null)),r.a.createElement("input",(e={className:"ant-input",value:this.state.login,prefix:r.a.createElement(Se.a,{className:"site-form-item-icon"}),placeholder:"Login..."},Object(S.a)(e,"value",this.state.login),Object(S.a)(e,"onChange",(function(e){return a.setState({login:e.target.value})})),e))),r.a.createElement("div",null,r.a.createElement("span",{className:"form","aria-hidden":"true"},r.a.createElement(Ne.a,{className:"site-form-item-icon"})),r.a.createElement("input",(t={className:"ant-input",value:this.state.password,prefix:r.a.createElement(Ne.a,{className:"site-form-item-icon"}),type:"password",placeholder:"Password..."},Object(S.a)(t,"value",this.state.password),Object(S.a)(t,"onChange",(function(e){return a.setState({password:e.target.value})})),t))))),r.a.createElement("div",{className:"block-login-button"},r.a.createElement(b.a,{type:"primary",htmlType:"submilogin-formt",className:"login-button",onClick:function(){return a.props.onLogin(a.state.login,a.state.password)}},r.a.createElement(d.a,{to:"/mychat"},"Sign in")),r.a.createElement("span",null,"New to MyChat?"),r.a.createElement(b.a,{type:"primary",htmlType:"submit",className:"registr-button"},r.a.createElement(d.a,{to:"/registration"}," Create an account")))))}}]),a}(n.Component);Object(f.b)((function(e){return{login:e.auth.data&&e.auth.data.sub.login}}))((function(e){var t=e.login;return t?r.a.createElement("a",{href:"/dashboard"},t):r.a.createElement("span",null,"Anon")}));var Te=Object(f.b)(null,{onLogin:function(e,t){return function(){var a=Object(j.a)(k.a.mark((function a(n){var r;return k.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n(C("login",_("query login($login: String, $password: String){\n            login(login: $login, password: $password)\n        }",{login:e,password:t})));case 2:r=a.sent,n(L(r.data.login));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}})(_e),qe=a(190),Pe=a(376),Ae=a(379),Ie=a(378),Re=a(386),Fe=(a(290),{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}}),Me={wrapperCol:{xs:{span:24,offset:0},sm:{span:16,offset:8}}},Le=function(){var e=Pe.a.useForm(),t=Object(qe.a)(e,1)[0];return r.a.createElement("div",{className:"RegistForm"},r.a.createElement(Pe.a,Object.assign({},Fe,{form:t,name:"register",onFinish:function(e){console.log("Received values of form: ",e)},initialValues:{residence:["zhejiang","hangzhou","xihu"],prefix:"86"},scrollToFirstError:!0}),r.a.createElement("span",null,"Join MyChat"),r.a.createElement("h1",null,"Create your account"),r.a.createElement(Pe.a.Item,{name:"login",label:r.a.createElement("span",null,"Login\xa0",r.a.createElement(Ae.a,{title:"Your name / nickname for authorization."},r.a.createElement(Re.a,null))),rules:[{required:!0,message:"Please input your Login!",whitespace:!0}]},r.a.createElement(Ie.a,null)),r.a.createElement(Pe.a.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please input your password!"}],hasFeedback:!0},r.a.createElement(Ie.a.Password,null)),r.a.createElement(Pe.a.Item,{name:"confirm",label:"Confirm Password",dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:"Please confirm your password!"},function(e){var t=e.getFieldValue;return{validator:function(e,a){return a&&t("password")!==a?Promise.reject("The two passwords that you entered do not match!"):Promise.resolve()}}}]},r.a.createElement(Ie.a.Password,null)),r.a.createElement(Pe.a.Item,{name:"nickname",label:r.a.createElement("span",null,"Nickname\xa0",r.a.createElement(Ae.a,{title:"What do you want others to call you?"},r.a.createElement(Re.a,null))),rules:[{required:!0,message:"Please input your nickname!",whitespace:!0}]},r.a.createElement(Ie.a,null)),r.a.createElement(Pe.a.Item,Me,r.a.createElement(b.a,{type:"primary",htmlType:"submit"},"Create account"))))},$e=function(){return r.a.createElement("div",null,r.a.createElement(we.c,null,r.a.createElement(we.a,{path:"/mychat",component:ye,exact:!0}),r.a.createElement(we.a,{path:"/chat/:_id",component:Ee,exact:!0})))},Ue=function(){return r.a.createElement("div",null,r.a.createElement(we.c,null,r.a.createElement(we.a,{path:"/",component:Te,exact:!0}),r.a.createElement(we.a,{path:"/registration",component:Le,exact:!0})))},He=Object(f.b)((function(e){return{logged:e.auth.jwt}}))((function(e){return e.logged?r.a.createElement($e,null):r.a.createElement(Ue,null)})),Ge=function(){return r.a.createElement(f.a,{store:M},r.a.createElement(we.b,{history:je()()},r.a.createElement(He,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ge,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[195,1,2]]]);
//# sourceMappingURL=main.16f97092.chunk.js.map